$def with (url,elevenrox_url,msg)
<html>
	<head>
		<title>jTime</title>
		<link rel="stylesheet" type="text/css" href="/static/$url/css/pure-min.css" />
		<link rel="stylesheet" type="text/css" href="/static/$url/css/pure-ob.css" />
		<link rel="stylesheet" type="text/css" href="/static/$url/css/bootstrap.css" />
		<link rel="stylesheet" type="text/css" href="/static/$url/css/jTime.css" />
		<script type="text/javascript" language="Javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script type="text/javascript" language="Javascript" src="https://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
		<script type="text/javascript" language="Javascript" src="/static/$url/js/jTime.js"></script>
		<script type="text/javascript" language="Javascript" src="/static/$url/elevenrox_js/elevenrox.js"></script>
		<script type="text/javascript" language="Javascript" src="/static/$url/js/zebra_datepicker.js"></script>
		<script type="text/javascript" language="Javascript" src="/static/$url/js/jquery.knob.js"></script>

	</head>
	<script type="text/javascript">

		var progress = 0;

		$$(document).ready(function() {

			// sort out the datepicker
			$$('#date').Zebra_DatePicker({
				direction: false,
				format: 'd/m/Y'
			});

			// set the date to yesterday
			$$('#date').val(yesterday());
		 });

		/*
		 * Returns yesterday in dd/mm/yyyy
		 */
		function yesterday() {

			var date = new Date(),
				d, m, y;

			date.setDate(date.getDate() - 1)

			d = ("00" + date.getDate()).slice (-2);
			m = ("00" + (date.getMonth()+1)).slice (-2);
			y = date.getFullYear();

			return d + '/' + m + '/' + y;
		}

		function do_submit() {
			var tenrox_user   = $('t_username').value,
			    tenrox_pass   = $('t_password').value,
			    elevenrox_url = '$elevenrox_url',
			    do_submit, er, loc;

			// disable the button
			$('submit_button').disabled = true;

			// bit of a hack, we should probably do this server side
			er = new ElevenRox(
				tenrox_user,
				tenrox_pass,
				elevenrox_url
			);

			do_submit_final = function(_resp) {
				// if we've logged in successfully, submit
				if (er.token) {
					$('tenrox_token').value = er.token;
					$('frm').submit();
				} else{
					// we've got some error, find what it is and report it
					if (_resp.error.code < 30000) {
						loc = '/$url?msg=HTTP_ELEVENROX';
					}

					if (_resp.error.code == -32001 && _resp.error.data.search('Invalid username or password') > -1) {
						loc = '/$url?msg=BAD_T_USER';
					}

					// dunno what the problem is
					if (typeof loc === undefined) {
						loc = '/$url?msg=UNKNOWN';
					}

					window.location.href = loc;
				}
			};

			er.login(do_submit_final);
			start_progress();
		}

		function start_progress() {
			progress = 0;
			$$(".dial").knob();
			$$('#knob').css('display','block');
			progress_forever();
		}

		function progress_forever() {

			if (progress == 100) {
				progress = 0;
			} else {
				progress++;
			}

			$$('.dial')
				.val(progress)
				.trigger('change');

			setTimeout(progress_forever, 175);
		}
	</script>
	<body class="pure-skin-ob">
		<div class="header">
			<h1>jTime</h1>
			<h2>Jira timesheet generator</h2>
		</div>
		<div class="content-centre">
			<div class="pure-g-r">
				<div class="pure-u-1-3"></div>
				<div class="pure-u-1-3">
					<form class="pure-form pure-form-aligned" id="frm" method="post" action="/$url/doJTime">
						<fieldset>
							<div class="pure-control-group">
								<input name="j_username" type="text" placeholder="Jira Username" required />
							</div>
							<div class="pure-control-group">
								<input name="j_password" type="password" placeholder="Jira Password" required />
							</div>
							<div class="pure-control-group">
								<input name="t_username" id="t_username" type="text" placeholder="Tenrox Username" required />
							</div>
							<div class="pure-control-group">
								<input name="t_password" id="t_password" type="password" placeholder="Tenrox Password" required />
							</div>
							<div class="pure-control-group">
								<input id="date" name="date" type="text" class="datepicker" placeholder="" required />
							</div>
							<label for="find_codes" class="pure-checkbox">
								<input id="find_codes" name="find_codes" type="checkbox">Find 10rx Codes (experimental)
							</label>
							<label for="remember" class="pure-checkbox">
								<input id="remember" type="checkbox" checked="checked">Remember?
							<p>
							<div class="pure-controls">
								<input type="button" id="submit_button" value="Login" class="pure-button pure-button-primary" onclick="javascript:do_submit()"//>
							</div>
							<input type="hidden" id="tenrox_token" name="tenrox_token" value="" />
						</fieldset>
					</form>
				</div>
				<div class="pure-u-1-3"></div>
			</div>
				$if msg is not None:
				<div class="error_msg">$msg</div>
			<div id="knob" class="iKnob" style="display: none">
				<input id="knob_input" type="text" value="0" data-width="100" data-height="100" data-displayInput=false data-fgColor="#7b4e8d" data-readOnly=true class="dial"/>
			</div>
		</div>
	</body>
</html>
